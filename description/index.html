<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Search Result</title>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
      <script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
      <link href="style.css" rel="stylesheet">
      <!--Change Navbar Color on Scroll & Pause video when you scroll down-->
      <script>
         $(window).scroll(function(){
         var scroll = $(window).scrollTop();
         var vid = document.getElementById("player");
         
              if(scroll < 100){
         $('.fixed-top').css('background', 'transparent'); 
         $('#slides').carousel({interval: 500});
              } else{
         $('.fixed-top').css('background', 'rgba(39, 39, 39)'); 
         
              }
         });
      </script>
   </head>
   <?php
include('../header.php');
?>
   <body>
      <!-- Navigation -->
      <?php
            if(isset($_GET['ID']))
            {
              ini_set('display_errors', 1);
              require_once "../dbcon/config.php";
              $ID = $_GET['ID'];
              $sql = "SELECT * FROM content WHERE cid = $ID";
              $result = $link->query($sql);

               while($row = $result->fetch_assoc()) 
               {
                  $description = $row["description"];
                  $type = $row["type"];
                  $studio = $row["studio"];
                  $title = $row["tittle"];
                  $year = $row["year"];
                  $genre = $row["genre"];
                  $image = $row["image"];
                  $imglin = "../img/".$image;
               }
            }




      ?>

      <!--Video Search Results -->
      <!-- LEFT SIDE CONTENT DESCRIPTION BOX-->
      <div class = "box-description" style= "margin-top: 100px; margin-bottom: 1000px; padding-bottom: 100px;">
         <h4>Show Information </h4>




         <hr style="border: 1px solid gray;  margin-left: 3%; margin-right: 3%; margin-top: 10px;"/>
         <!--Line Divider-->
         <img src="<?php echo $imglin?>" alt="test">
         <!--All the Movie/Show's Info-->
         <h1> <?php echo $title?> </h1>
         <h2><span> Type: </span> <?php echo $type?> </h2>
         <h2><span>Description: </span><?php echo $description?></h2>
         <h2><span>Genre: </span><?php echo $genre?></h2>
         <h2><span>Studio:</span><?php echo $studio?></h2>
         <h2><span>Released: </span><?php echo $year?></h2>
         <h2> <span>Status: </span> Finished</h2>
                  <?php
         if ( $type == "show")
         {

            $uid = $_SESSION['id'];
            $sql = "SELECT * FROM `subscription` WHERE cid = $ID AND uid = $uid";
            $result = $link->query($sql);
            if ($result->num_rows > 0)  
            //if (is_null($result))
            {
            //                           //<form method="POST">                
                  //<button type="submit" name="unsub-button"> unsubscribe </button>
                  //</form>
                           echo '<h1> <a href="#" class="btn btn-outline-danger"  name="unsub-button" style = "margin:-1px;" role="button"> Unsubscribe</a> </h1>';

            }
            else
            {
               echo '<form method="POST">                
                  <button type="submit" name="sub-button"> subscribe </button>
                  </form>';
            }
         }



         else
         {
            $uid = $_SESSION['id'];
            $sql = "SELECT * FROM `rental` WHERE cid = $ID AND uid = $uid";
            $result = $link->query($sql);
            if ( !($result->num_rows > 0))
            {   
               echo '<form method="POST">                
                  <button type="submit" name="rent-button"> rent </button>
               </form>';
            }
         }

         ?>
         <h3><?php echo $title?></h3>
         <hr style="border: 1px solid gray; transform: translateY(-210px); margin-left: 3%; margin-right: 3%;"/>
         <!--Line Divider-->
         <!--All the Show/Movies Episodes in a Button-->
         <?php
         if ( isset($_POST['sub-button']) )
         {
            if(isset($_GET['ID']))
            {
               ini_set('display_errors', 1);
               require_once "../dbcon/config.php";
               $uid = $_SESSION['id'];
               $sql = "INSERT INTO subscription (cid,uid,days_left) VALUES ($ID,$uid,30)";

               if ($link->query($sql) === TRUE) 
               {
                  echo "<script type='text/javascript'>alert(\"Added to subscription\");</script>";
               } 

               else 
               {
                  echo "<script type='text/javascript'>alert(\"Erorr.$sql\");</script>";
               }
            }
         }

         if ( isset($_POST['unsub-button']) )
         {
            if(isset($_GET['ID']))
            {
               ini_set('display_errors', 1);
               require_once "../dbcon/config.php";
               $uid = $_SESSION['id'];
               $sql = "DELETE FROM subscription WHERE cid = $ID AND uid = $uid";

               if ($link->query($sql) === TRUE) 
               {
                  echo "<script type='text/javascript'>alert(\"Unsubscribed\");</script>";
               } 

               else 
               {
                  echo "<script type='text/javascript'>alert(\"Erorr.$sql\");</script>";
               }
            }
         }

         if ( isset($_POST['rent-button']) )
         {
            if(isset($_GET['ID']))
            {
               ini_set('display_errors', 1);
               require_once "../dbcon/config.php";
               $uid = $_SESSION['id'];
               $sql = "INSERT INTO rental (cid,uid,hours_left) VALUES ($ID,$uid,24)";

               if ($link->query($sql) === TRUE) 
               {
                  echo "<script type='text/javascript'>alert(\"Added to Rentals\");</script>";
               } 

               else 
               {
                  echo "<script type='text/javascript'>alert(\"Erorr.$sql\");</script>";
               }
            }
         }


         ?>




          




      <?php
            if(isset($_GET['ID']))
            {

            $uid = $_SESSION['id'];
            $sql = "SELECT * FROM `subscription` WHERE cid = $ID AND uid = $uid";
            $result = $link->query($sql);
            
            if ($result->num_rows > 0)  
            {

              $sql = "SELECT * FROM episodes WHERE cid = $ID";
              $result = $link->query($sql);

               while($row = $result->fetch_assoc()) 
               {
                  $epnum = $row["ep_num"];
                  $full_link = "http://danc.ddns.net/videos/?ID=".$ID."&EID=".$epnum;

                  echo ' <a href='.$full_link.' class="btn btn-outline-secondary" role="button">Episode: '.$epnum.'&nbsp; </a>';

               }
            }

            else
            {
               $uid = $_SESSION['id'];
               $sql = "SELECT * FROM `rental` WHERE cid = $ID AND uid = $uid";
               $result = $link->query($sql);
               if ($result->num_rows > 0)  
               {
                  $sql = "SELECT * FROM episodes WHERE cid = $ID";
                  $result = $link->query($sql);

               while($row = $result->fetch_assoc()) 
               {
                  $epnum = $row["ep_num"];
                  $full_link = "http://danc.ddns.net/videos/?ID=".$ID."&EID=".$epnum;

                  echo ' <a href='.$full_link.' class="btn btn-outline-secondary" role="button">Watch Movie</a>';

               }

               }


            }


            
            }

      ?>

      
         <p style ="color: green; margin-left: 3%; transform: translateY(-580px);"> Leave a comment!</p>
  
      </div>
      <div class= "box-suggested" style = "margin-top: 100px; margin-bottom: 1000px; padding-bottom: 100px;">
         <h1>Recent Releases</h1>
         <hr style="border: 1px solid gray;  margin-left: 3%; margin-right: 3%; margin-top: 10px;"/>
         <!--Line Divider-->
         <table style="width:100%; ">
            <?php
              $sql = "SELECT * FROM `content` ORDER by cid DESC Limit 12";
              $result = $link->query($sql);
            
              while($row = $result->fetch_assoc()) 
               {
                  $CID = $row["cid"];
                  $ctittle = $row["tittle"];
                  $imgsrc = $row["image"];
                  $full_link = "http://danc.ddns.net/description/?ID=".$CID;

                  echo ' 
                  <tr>
                     <td><a href="'.$full_link.'"><img src="..img/'.$imgsrc.'" alt="" width="50" height="50" /> </a></td>
                     <td><a href= "'.$full_link.'" style="margin-right:1em;">'.$ctittle.'</a> </td>
                </tr> 
                </a>';

               }       
            ?>           
            
         </table> 
      </div>
      <!--- Footer -->
      <div class = "sticky-bottom" style= "padding-top: 300%;">
         <footer id = "footer" >
            <div class="wrap">
               <div class="left-footer">
                  <h3><a href="#">About Us</a></h3>
                  <h3><a href="#">FAQ</a></h3>
                  <h3><a href="#">Contact Us</a></h3>
                  <h3><a href="#">Terms & Conditions</a></h3>
               </div>
               <div class="right-footer">
                  <h3> Follow us on Social Media!</h3>
                  <h2> <a href="#"><i class="fab fa-facebook-square"></i></a>
                     <a href="#"><i class="fab fa-twitter-square"></i> </a>
                     <a href="#"><i class="fab fa-google-plus-square"></i> </a>
                  </h2>
               </div>
               <div class="center-footer">
                  <h3><a href="#">About Us</a></h3>
                  <h3><a href="#">FAQ</a></h3>
                  <h3><a href="#">Contact Us</a></h3>
                  <h3><a href="#">Terms & Conditions</a></h3>
               </div>
            </div>
         </footer>
      </div>
   </body>
</html>
